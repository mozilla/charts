<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<HTML>
<HEAD>
	<title>FFOS - Projects Dashboard</title>
	<script type="text/javascript">function importScript(dep, func){if (func!==undefined) func();}</script>
	<script type="text/javascript" src="js/Settings.js"></script>
	<script type="text/javascript" src="js/MozillaPrograms.js"></script>
	<script type="text/javascript" src="js/rest/BugzillaClient.js"></script>
	<script type="text/javascript" src="js/collections/aArray.js"></script>
	<script type="text/javascript" src="js/util/aUtil.js"></script>
	<script type="text/javascript" src="js/util/aParse.js"></script>
	<script type="text/javascript" src="js/collections/aMatrix.js"></script>
	<script type="text/javascript" src="js/qb/Qb.aggregate.js"></script>
	<script type="text/javascript" src="js/qb/Qb.column.js"></script>
	<script type="text/javascript" src="js/qb/Qb.cube.js"></script>
	<script type="text/javascript" src="js/qb/Qb.analytic.js"></script>
	<script type="text/javascript" src="js/gui/Filter.js"></script>
	<script type="text/javascript" src="js/gui/ComponentFilter.js"></script>
	<script type="text/javascript" src="js/gui/PartitionFilter.js"></script>
	<script type="text/javascript" src="js/qb/aCompiler.js"></script>
	<script type="text/javascript" src="js/collections/aRelation.js"></script>
	<script type="text/javascript" src="js/math/aMath.js"></script>
	<script type="text/javascript" src="js/util/aString.js"></script>
	<script type="text/javascript" src="js/collections/aQueue.js"></script>
	<script type="text/javascript" src="js/collections/aSet.js"></script>
	<script type="text/javascript" src="js/util/CNV.js"></script>
	<script type="text/javascript" src="js/util/aDate.js"></script>
	<script type="text/javascript" src="lib/jquery.js"></script>
	<script type="text/javascript" src="js/debug/aException.js"></script>
	<script type="text/javascript" src="js/qb/Qb.domain.js"></script>
	<script type="text/javascript" src="js/util/aDuration.js"></script>
	<script type="text/javascript" src="lib/jquery-ui/js/jquery-ui-1.10.2.custom.js"></script>
	<script type="text/javascript" src="lib/jquery.numberformatter.js"></script>
	<script type="text/javascript" src="lib/jstree/jquery.jstree.js"></script>
	<link type="text/css" rel="stylesheet" href="lib/jquery-ui/css/start/jquery-ui-1.10.2.custom.css">
	<script type="text/javascript" src="js/aFormat.js"></script>
	<script type="text/javascript" src="lib/ccc/lib/protovis-d3.3.js"></script>
	<script type="text/javascript" src="js/gui/TeamFilter.js"></script>
	<script type="text/javascript" src="js/debug/aLog.js"></script>
	<script type="text/javascript" src="lib/jquery.ba-bbq/jquery.ba-bbq.js"></script>
	<script type="text/javascript" src="lib/ccc/lib/protovis-msie.js"></script>
	<script type="text/javascript" src="js/threads/thread.js"></script>
	<script type="text/javascript" src="js/gui/ProgramFilter.js"></script>
	<script type="text/javascript" src="js/util/aTimer.js"></script>

	<script type="text/javascript" src="lib/ccc/lib/jquery.tipsy.js"></script>
	<script type="text/javascript" src="js/rest/Rest.js"></script>
	<script type="text/javascript" src="js/aLibrary.js"></script>

	<script type="text/javascript" src="lib/ccc/lib/tipsy.js"></script>
	<script type="text/javascript" src="js/rest/ElasticSearch.js"></script>
	<script type="text/javascript" src="js/Bugzilla.js"></script>
	<script type="text/javascript" src="js/Hierarchy.js"></script>
	<script type="text/javascript" src="js/math/Stats.js"></script>
	<script type="text/javascript" src="js/ScrumBugs.js"></script>
	<script type="text/javascript" src="js/qb/MVEL.js"></script>
	<link type="text/css" rel="stylesheet" href="lib/jquery-linedtextarea/jquery-linedtextarea.css">
	<link type="text/css" rel="stylesheet" href="lib/ccc/lib/tipsy.css">
	<script type="text/javascript" src="js/qb/Qb.js"></script>
	<script type="text/javascript" src="lib/jquery-linedtextarea/jquery-linedtextarea.js"></script>
	<script type="text/javascript" src="lib/ccc/def/def.js"></script>
	<script type="text/javascript" src="js/qb/ESQuery.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvc.js"></script>
	<script type="text/javascript" src="js/Dimension.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvc.text.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvc.color.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvc.trends.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvc.options.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/_data.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/meta/DimensionType.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/meta/ComplexType.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/meta/ComplexTypeProject.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/TranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/MatrixTranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/CrosstabTranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/RelationalTranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Atom.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Complex.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/ComplexView.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Datum.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Dimension.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Data.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Data.selected.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/GroupingSpec.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/DataOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/GroupingOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/LinearInterpolationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/LinearInterpolationOperSeriesState.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/ZeroInterpolationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/ZeroInterpolationOperSeriesState.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Data.operations.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/Data.compat.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Role.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Scene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Var.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/BasicSign.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Sign.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Panel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Label.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Dot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Line.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Area.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Bar.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/PieSlice.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/sign/Rule.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Context.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/OptionsBase.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Axis.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/CartesianAxis.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/CartesianAxisRootScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/CartesianAxisTickScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/CartesianFocusWindow.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/ColorAxis.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/SizeAxis.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/Legend.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletRootScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletGroupScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletItemScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletItemSceneSelection.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletItemSceneVisibility.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletItemRenderer.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/BulletItemDefaultRenderer.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/Plot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/CartesianPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/CategoricalPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/BarPlotAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/BarPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/NormalizedBarPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/WaterfallPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/PointPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/MetricXYPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/MetricPointPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/PiePlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/HeatGridPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/BoxPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/plot/BulletPlot.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.visualRoles.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.data.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.plots.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.axes.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.panels.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.selection.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBaseChart.extension.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBasePanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPlotPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcMultiChartPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcTitlePanelAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcTitlePanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcLegendPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcCartesianAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcGridDockingPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcCartesianGridDockingPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcCartesianAbstractPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPlotBgPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcCategoricalAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcCategoricalAbstractPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcAxisPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcAxisTitlePanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPiePanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPieChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBarAbstractPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBarAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBarPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBarChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcNormalizedBarPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcNormalizedBarChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/visual/legend/WaterfallBulletGroupScene.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcWaterfallPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcWaterfallChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPointPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcPoint.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcHeatGridPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcHeatGridChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcMetricXYAbstract.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/MetricPointChartTranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcMetricPointPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcMetricPoint.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBulletChart.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcParallelCoordinates.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcDataTree.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/data/translation/BoxplotChartTranslationOper.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBoxplotPanel.js"></script>
	<script type="text/javascript" src="lib/ccc/pvc/pvcBoxplotChart.js"></script>
	<script type="text/javascript" src="lib/ccc/data/q01-01.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	<script type="text/javascript" src="js/Dimension-Bugzilla.js"></script>
	<script type="text/javascript" src="js/Dimension-B2G.js"></script>
	<script type="text/javascript" src="js/gui/dynamic.js"></script>
	<script type="text/javascript" src="js/gui/GUI.js"></script>
	<script type="text/javascript" src="js/charts/aColor.js"></script>
	<script type="text/javascript" src="js/charts/aChart.js"></script>
	<script type="text/javascript" src="js/gui/ProductFilter.js"></script>
	<script type="text/javascript" src="b2g/heat.js"></script>
	<script type="text/javascript" src="b2g/grid.js"></script>
	<link type="text/css" rel="stylesheet" href="css/menu.css">
	<style id="vakata-stylesheet" type="text/css"></style>
	<style id="jstree-stylesheet" type="text/css"></style>
	<link type="text/css" rel="stylesheet" href="b2g/blockers.css">

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-49796218-5', 'mozilla.org');
  ga('send', 'pageview');
	</script>
</HEAD>
<BODY>

<div id="sidebar" style="width:250px;">
	<br>
	<br>

	<div style="height: 30px; text-align: center;vertical-align:middle;">
		<span id="status" style="height:30px">Page Loading...</span><span class="loading"><img src="images/spinner.gif" alt=""></span>
	</div>
	<hr>
	<div id="description">
		<div id="day0" style="display:inline-block;height:10px;width:10px;background-color:#008E00;"></div>
		New<br>
		<div id="day1" style="display:inline-block;height:10px;width:10px;background-color:#318000;"></div>
		1 day old<br>
		<div id="day2" style="display:inline-block;height:10px;width:10px;background-color:#638700;"></div>
		2 days old<br>
		<div id="day3" style="display:inline-block;height:10px;width:10px;background-color:#857B00;"></div>
		3 days old<br>
		<div id="day4" style="display:inline-block;height:10px;width:10px;background-color:#A05700;"></div>
		4 days old<br>
		<div id="day5" style="display:inline-block;height:10px;width:10px;background-color:#8B3C00;"></div>
		5 days old<br>
		<div id="day6" style="display:inline-block;height:10px;width:10px;background-color:#8A1C00;"></div>
		6 days old<br>
		<div id="day7" style="display:inline-block;height:10px;width:10px;background-color:#980303;"></div>
		7+ days old<br>

		<div style="display:inline-block;bottom:0;width: 0;height: 0; border-style: solid; border-width: 0 0 10px 10px; border-color: transparent transparent #000000 transparent;"></div>
		Nobody Assigned<br>
	</div>

</div>


<div style="align:left;position:relative;float:left;width:800px;padding-top: 10px;">
	<h3 id="title">FFOS Projects Dashboard</h3>

	<div>
		<div id="info" style="width:800px;"></div>

	</div>
	<div class="footer">Source at
		<a href="https://github.com/mozilla/charts/blob/master/ffos/overall.html">https://github.com/mozilla/charts/blob/master/ffos/overall.html</a></div>
</div>

<script type="application/javascript">




importScript(['js/main.js', 'js/Dimension-Bugzilla.js', "js/Dimension-B2G.js", "b2g/grid.js"], function () {
	var thread;
	var createChart = function () {
		if (thread !== undefined)
			thread.kill();
		thread = Thread.run(__createChart());
	};

	//REFRESH PERIODICALLY
	Thread.daemon(function*(){
		while(true){
			try{
				yield (Thread.sleep(5*60*1000));
				createChart();
			} catch(e){
				//do nothing
			}//try
		}//while
	});

	var __createChart = function*() {
		NOW = Date.today();
		TOO_LATE = NOW.subtract(Duration.newInstance("2day"));
		REALLY_TOO_LATE = NOW.subtract(Duration.newInstance("1week"));

		var mainFilter = {"and": [
			Mozilla.BugStatus.Open.esfilter,
			Mozilla.B2G.esfilter,
			Mozilla.CurrentRecords.esfilter
		]};

		yield (ESQuery.loadColumns({"from": "bugs"}));

		var a=Log.action("Load all details", true);
		var allBugs=yield(ESQuery.run({
			"from":"bugs",
			"select":[
				"bug_id",
				"cf_blocking_b2g",
				"product",
				"component",
				"assigned_to",
				"modified_ts",
					"keywords"
			],
			"esfilter":mainFilter
		}));
		Log.actionDone(a);

		var counting = null;
		var countingThread = Thread.run(function*() {
			counting = yield(Q({
				"from": allBugs,
				"select": {"name": "count", "value": "bug_id", "aggregate": "count"},
				"edges": [
					{"name": "Team", "domain": Mozilla.B2G.Team.getDomain()},
					{"name": "Project", "domain": Mozilla.B2G.Project.getDomain()},
					{"name": "State", "domain": Mozilla.B2G.State.getDomain()}
				]
			}));
			yield (null);
		});

		var ages = null;
		var ageThread = Thread.run(function*() {
			ages = yield(Q({
				"from": allBugs,
				"select": [
					{"name": "oldest", "value": "modified_ts", "aggregate": "minimum"},
					{"name": "age", "value": "Date.now().subtract(Date.newInstance(modified_ts)).divideBy(Duration.DAY)", "aggregate": "maximum"}
				],
				"edges": [
					{"name": "Team", "domain": Mozilla.B2G.Team.getDomain()},
					{"name": "Project", "domain": Mozilla.B2G.Project.getDomain()},
					{"name": "State", "domain": Mozilla.B2G.State.getDomain()}
				]
			}));
		});

		var uBlocker = null;
		var uBlockerThread = Thread.run(function*() {
			uBlocker = yield(Q({
				"from": allBugs,
				"select": {"name": "unassigned", "value": "bug_id", "aggregate": "count"},
				"edges": [
					{"name": "Team", "domain": Mozilla.B2G.Team.getDomain()},
					{"name": "Project", "domain": Mozilla.B2G.Project.getDomain()},
					{"name": "State", "domain": Mozilla.B2G.State.getDomain()}
				],
				"where": {"and": [
					{"term": {"assigned_to": "nobody@mozilla.org"}},
					Mozilla.B2G.Blockers.esfilter
				]}
			}));
		});

		yield (Thread.join(countingThread));
		yield (Thread.join(ageThread));
		yield (Thread.join(uBlockerThread));

		var both = Qb.merge([
			{"from": counting, "edges": ["Team", "Project", "State"]},
			{"from": ages, "edges": ["Team", "Project", "State"]},
			{"from": uBlocker, "edges": ["Team", "Project", "State"]}
		]);

		//EXPOSE NULLS AS LEGITIMATE PARTS
		both.edges.forall(function (edge, e) {
			if (edge.allowNulls) {
				edge.domain.partitions.append(edge.domain.NULL);
				edge.allowNulls = false;
			}//endif
		});

		both.name = "Teams";
		var html = cube2grid({
			"cube": both,
			"rows": ["Team"],
			"columns": ["Project", "State"]
		});
		$("#info").html(html).updateDynamicStyle();
		addNumberClickers(both, mainFilter);
		addTeamClickers(both);

	};

	$(document).ready(function () {
		GUI.setup(
				createChart,
				[],
				[],
				null,
				false		//SHOW DEFAULT FILTERS?
		);
	});
});



</script>


</BODY>
</HTML>

